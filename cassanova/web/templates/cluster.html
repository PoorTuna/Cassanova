{% extends "base.html" %}

{% block title %}Cluster: {{ cluster.metrics.name }}{% endblock %}

{% block head_extra %}
<link href="/static/scripts/vendor/vis/vis-network.min.css" rel="stylesheet" />
<link href="/static/styles/app/keyspaces.css" rel="stylesheet" />
<script src="/static/scripts/vendor/vis/vis-network.min.js" defer></script>
<script src="/static/scripts/app/keyspace-controls.js" defer></script>
<script src="/static/scripts/app/topology-graph.js" defer></script>
<script>
    const clusterData = JSON.parse('{{ cluster.model_dump() | tojson | safe }}');
    const clusterConfigName = '{{cluster_config_entry}}';
</script>
{% endblock %}

{% block content %}
<main class="with-sidebar">

    <!-- Cluster Overview -->
    <section class="cluster-overview status-{{ cluster.metrics.status.lower() | default('unknown') }}">
        <h2>Cluster Overview</h2>
        <ul>
            <li class="copyable" title="Click to copy"><strong>Name</strong><span>{{ cluster.metrics.name }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Version</strong><span>{{ cluster.metrics.version
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Technology</strong><span>{{ cluster.metrics.technology |
                    capitalize }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Partitioner</strong><span>{{ cluster.metrics.partitioner
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Snitch</strong><span>{{ cluster.metrics.snitch }}</span>
            </li>
            <li class="copyable" title="Click to copy"><strong>Status</strong><span>{{ cluster.metrics.status }}</span>
            </li>
            <li class="copyable" title="Click to copy"><strong>Nodes Same Version</strong><span>{{
                    cluster.metrics.is_fully_upgraded }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Total Nodes</strong><span>{{ cluster.metrics.total_nodes
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Nodes Up</strong><span>{{ cluster.metrics.up_nodes
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Nodes Down</strong><span>{{ cluster.metrics.down_nodes
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Datacenters</strong><span>{{ cluster.metrics.dc_count
                    }}</span></li>
            <li class="copyable" title="Click to copy"><strong>Racks</strong><span>{{ cluster.metrics.rack_count
                    }}</span></li>
        </ul>
    </section>

    <section class="fade-in">
        <div class="section-header-row">
            <h2>Keyspaces</h2>
            <div class="actions">
                <a href="/cluster/{{ cluster_config_entry }}/builder/keyspace" class="btn-primary-sm">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"></path>
                    </svg>
                    Create New Keyspace
                </a>
            </div>
        </div>
        <input type="search" id="keyspace-filter" placeholder="Filter keyspaces..." autocomplete="off" />

        <div class="keyspaces-container">
            <!-- Sidebar List -->
            <div id="keyspace-list">
                {% for ks in cluster.keyspaces %}
                <div class="keyspace-item" data-name="{{ ks.name }}" data-replication="{{ ks.replication }}"
                    data-tablecount="{{ ks.table_count }}" data-durable="{{ ks.durable_writes }}"
                    data-virtual="{{ ks.virtual }}">
                    <strong>{{ ks.name }}</strong>
                    <div class="keyspace-meta">Tables: {{ ks.table_count }}</div>
                </div>
                {% else %}
                <p class="no-keyspaces">No keyspaces available.</p>
                {% endfor %}
            </div>

            <div id="keyspace-detail">
                <div class="empty-state">
                    <div class="icon-layer">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                            <path d="M3 5c0 1.66 4 3 9 3s9-1.34 9-3"></path>
                            <path d="M21 5v14c0 1.66-4 3-9 3s-9-1.34-9-3V5"></path>
                        </svg>
                    </div>
                    <p>Select a keyspace to view details</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Topology Graph -->
    <section class="fade-in">
        <h2>Data Layout</h2>
        <div id="topology-graph"
            style="width: 100%; height: 400px; border: 1px solid var(--glass-border); border-radius: 16px;"></div>
    </section>

</main>
{% endblock %}