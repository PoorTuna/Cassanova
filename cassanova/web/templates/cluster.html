{% extends "base.html" %}

{% block title %}Cluster: {{ cluster.metrics.name }}{% endblock %}

{% block head_extra %}
<link href="/static/scripts/vendor/vis/vis-network.min.css" rel="stylesheet"/>
<script src="/static/scripts/vendor/vis/vis-network.min.js" defer></script>
<script src="/static/scripts/app/keyspace-controls.js" defer></script>
<script src="/static/scripts/app/topology-graph.js" defer></script>
<script>
    const clusterData = JSON.parse('{{ cluster.model_dump() | tojson | safe }}');
    const clusterConfigName = '{{cluster_config_entry}}';
</script>
{% endblock %}

{% block content %}
<main class="with-sidebar">

    <!-- Cluster Overview -->
    <section class="cluster-overview status-{{ cluster.metrics.status.lower() | default('unknown') }}">
        <h2>Cluster Overview</h2>
        <ul>
            <li><strong>Name</strong><span>{{ cluster.metrics.name }}</span></li>
            <li><strong>Version</strong><span>{{ cluster.metrics.version }}</span></li>
            <li><strong>Technology</strong><span>{{ cluster.metrics.technology | capitalize }}</span></li>
            <li><strong>Partitioner</strong><span>{{ cluster.metrics.partitioner }}</span></li>
            <li><strong>Snitch</strong><span>{{ cluster.metrics.snitch }}</span></li>
            <li><strong>Status</strong><span>{{ cluster.metrics.status }}</span></li>
            {% if cluster.metrics.cluster_size %}
            <li><strong>Cluster Size</strong><span>{{ cluster.metrics.cluster_size }}</span></li>
            {% endif %}
            <li><strong>Nodes Same Version</strong><span>{{ cluster.metrics.is_fully_upgraded }}</span></li>
            <li><strong>Total Nodes</strong><span>{{ cluster.metrics.total_nodes }}</span></li>
            <li><strong>Nodes Up</strong><span>{{ cluster.metrics.up_nodes }}</span></li>
            <li><strong>Nodes Down</strong><span>{{ cluster.metrics.down_nodes }}</span></li>
            <li><strong>Datacenters</strong><span>{{ cluster.metrics.dc_count }}</span></li>
            <li><strong>Racks</strong><span>{{ cluster.metrics.rack_count }}</span></li>
        </ul>
    </section>

    <section class="fade-in">
        <h2>Keyspaces</h2>
        <input type="search" id="keyspace-filter" placeholder="Filter keyspaces..." autocomplete="off"/>

        <div class="keyspaces-container">
            <!-- Sidebar List -->
            <div id="keyspace-list">
                {% for ks in cluster.keyspaces %}
                <div class="keyspace-item"
                     data-name="{{ ks.name }}"
                     data-replication="{{ ks.replication }}"
                     data-tablecount="{{ ks.table_count }}"
                     data-durable="{{ ks.durable_writes }}"
                     data-virtual="{{ ks.virtual }}">
                    <strong>{{ ks.name }}</strong>
                    <div class="keyspace-meta">Tables: {{ ks.table_count }}</div>
                </div>
                {% else %}
                <p class="no-keyspaces">No keyspaces available.</p>
                {% endfor %}
            </div>

            <div id="keyspace-detail">
                <p>Select a keyspace to view details.</p>
            </div>
        </div>
    </section>

    <!-- Topology Graph -->
    <section class="fade-in">
        <h2>Data Layout</h2>
        <div id="topology-graph"></div>
    </section>

    <footer>
        <p>&copy; {{ current_year }} Oren Kessler - Cassanova</p>
    </footer>
</main>
{% endblock %}
