{% extends "base.html" %}

{% block title %}Cluster: {{ cluster.metrics.name }}{% endblock %}

{% block head_extra %}
<link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet"/>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js" defer></script>
<script src="/static/scripts/keyspace-controls.js" defer></script>
<script>const clusterData = JSON.parse('{{ cluster.model_dump() | tojson | safe }}');</script>
<script src="/static/scripts/topology-graph.js" defer></script>
{% endblock %}

{% block content %}
<main class="with-sidebar">

    <section class="cluster-overview status-{{ cluster.metrics.status.lower() | default('unknown') }}">
        <h2>Cluster Overview</h2>
        <ul>
            <li><strong>Name</strong><span data-fulltext="{{ cluster.metrics.name }}">{{ cluster.metrics.name }}</span>
            </li>
            <li><strong>Version</strong><span data-fulltext="{{ cluster.metrics.version }}">{{ cluster.metrics.version }}</span>
            </li>
            <li><strong>Technology</strong><span data-fulltext="{{ cluster.metrics.technology }}">{{ cluster.metrics.technology | capitalize }}</span>
            </li>
            <li><strong>Partitioner</strong><span data-fulltext="{{ cluster.metrics.partitioner }}">{{ cluster.metrics.partitioner }}</span>
            </li>
            <li><strong>Snitch</strong><span
                    data-fulltext="{{ cluster.metrics.snitch }}">{{ cluster.metrics.snitch }}</span></li>
            <li><strong>Status</strong><span
                    data-fulltext="{{ cluster.metrics.status }}">{{ cluster.metrics.status }}</span></li>
            {% if cluster.metrics.cluster_size %}
            <li><strong>Cluster Size</strong><span data-fulltext="{{ cluster.metrics.cluster_size }}">{{ cluster.metrics.cluster_size }}</span>
            </li>
            {% endif %}
            <li><strong>Nodes Same Version</strong><span data-fulltext="{{ cluster.metrics.is_fully_upgraded }}">{{ cluster.metrics.is_fully_upgraded }}</span>
            </li>
            <li><strong>Total Nodes</strong><span data-fulltext="{{ cluster.metrics.total_nodes }}">{{ cluster.metrics.total_nodes }}</span>
            </li>
            <li><strong>Nodes Up</strong><span data-fulltext="{{ cluster.metrics.up_nodes }}">{{ cluster.metrics.up_nodes }}</span>
            </li>
            <li><strong>Nodes Down</strong><span data-fulltext="{{ cluster.metrics.down_nodes }}">{{ cluster.metrics.down_nodes }}</span>
            </li>
            <li><strong>Datacenters</strong><span data-fulltext="{{ cluster.metrics.dc_count }}">{{ cluster.metrics.dc_count }}</span>
            </li>
            <li><strong>Racks</strong><span data-fulltext="{{ cluster.metrics.rack_count }}">{{ cluster.metrics.rack_count }}</span>
            </li>
        </ul>
    </section>

    <section class="fade-in">
        <h2>Keyspaces</h2>
        <input type="search" id="keyspace-filter" placeholder="Filter keyspaces..." aria-label="Filter keyspaces"
               autocomplete="off"/>
        <div class="keyspace-carousel-container">
            <button class="carousel-btn left" aria-label="Scroll keyspaces left">&#8592;</button>
            <div class="keyspace-carousel" id="keyspace-carousel">
                {% for ks in cluster.keyspaces %}
                <article class="keyspace-card">
                    <h3><a href="/cluster/{{ cluster_config_entry }}/keyspace/{{ ks.name }}">{{ ks.name }}</a></h3>
                    <p><strong>Replication:</strong> {{ ks.replication }}</p>
                    <p><strong>Table Count:</strong> {{ ks.table_count }}</p>
                    <p><strong>Durable Writes:</strong> {{ ks.durable_writes }}</p>
                    <p><strong>Virtual Table:</strong> {{ ks.virtual }}</p>
                </article>
                {% else %}
                <p>No keyspaces data available.</p>
                {% endfor %}
            </div>
            <button class="carousel-btn right" aria-label="Scroll keyspaces right">&#8594;</button>
        </div>
    </section>

    <section class="fade-in">
        <h2>Data Layout</h2>
        <div id="topology-graph" style="width: 100%; height: 400px; border: 1px solid #ccc; border-radius: 8px;"></div>
    </section>

    <footer>
        <p>&copy; {{ current_year }} Oren Kessler - Cassanova</p>
    </footer>
</main>
{% endblock %}
