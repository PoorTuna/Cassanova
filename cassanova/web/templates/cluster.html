<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="icon" type="image/png" href="/static/icons/logo/cassanova-logo.png" />
    <title>Cluster: {{ cluster.metrics.name }}</title>
    <link href="/static/styles/main.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js" defer></script>
    <script id="cluster-data" type="application/json" style="display:none;" defer>{{cluster.model_dump() | tojson | safe}}</script>
    <script src="/static/scripts/keyspace-controls.js" defer></script>
    <script src="/static/scripts/topology-graph.js" defer></script>

</head>
<body>
<header class="status-{{ cluster.metrics.status.lower() | default('unknown') }}">
    <h1>
        <a href="/cluster/{{ cluster_config_entry }}"
           style="text-decoration: none; color: inherit; display: flex; align-items: center;">
            <img src="/static/icons/logo/cassanova-logo.png" alt="Logo"
                 style="width: 40px; height: 40px; margin-right: 8px;">
            Cassanova - {{ cluster.metrics.name }}
        </a>
    </h1>

    <div class="header-buttons">
        <a href="/cluster/{{ cluster_config_entry }}/nodes" title="Nodes" aria-label="Nodes" class="nodes-btn-link">
            <button type="button" class="nodes-btn">Nodes</button>
        </a>
        <a href="{{ monitoring_url }}" title="Monitoring" aria-label="Monitoring" class="nodes-btn-link">
            <button type="button" class="nodes-btn">Monitoring</button>
        </a>
        <a href="/cluster/{{ cluster_config_entry }}/operations" title="Operations" aria-label="Operations" class="nodes-btn-link">
            <button type="button" class="nodes-btn">Operations</button>
        </a>
        <a href="/" title="Disconnect" aria-label="Disconnect" class="header-icon-link">
            <img src="/static/icons/misc/disconnect.png" alt="Disconnect" class="header-icon"/>
        </a>
    </div>
</header>

<main>
    <section class="cluster-overview">
        <h2>Cluster Overview</h2>
        <ul>
            <li><strong>Name</strong><span data-fulltext="{{ cluster.metrics.name }}" title="{{ cluster.metrics.name }}">{{ cluster.metrics.name }}</span>
            </li>
            <li><strong>Version</strong><span data-fulltext="{{ cluster.metrics.version }}" title="{{ cluster.metrics.version }}">{{ cluster.metrics.version }}</span>
            </li>
            <li><strong>Technology</strong><span data-fulltext="{{ cluster.metrics.technology }}"
                      title="{{ cluster.metrics.technology }}">{{ cluster.metrics.technology | capitalize }}</span></li>
            <li><strong>Partitioner</strong><span data-fulltext="{{ cluster.metrics.partitioner }}"
                                                  title="{{ cluster.metrics.partitioner }}">{{ cluster.metrics.partitioner }}</span>
            </li>
            <li><strong>Snitch</strong><span data-fulltext="{{ cluster.metrics.snitch }}"
                                             title="{{ cluster.metrics.snitch }}">{{ cluster.metrics.snitch }}</span>
            </li>
            <li><strong>Status</strong><span data-fulltext="{{ cluster.metrics.status }}"
                                             title="{{ cluster.metrics.status }}">{{ cluster.metrics.status }}</span></li>
            <li><strong>Cluster Size</strong><span data-fulltext="{{ cluster.metrics.cluster_size }}"
                                            title="{{ cluster.metrics.cluster_size }}">{{ cluster.metrics.cluster_size }}</span></li>
            <li><strong>Nodes Same Version</strong><span data-fulltext="{{ cluster.metrics.is_fully_upgraded }}"
                                            title="{{ cluster.metrics.is_fully_upgraded }}">{{ cluster.metrics.is_fully_upgraded }}</span></li>
            <li><strong>Total Nodes</strong><span data-fulltext="{{ cluster.metrics.total_nodes }}"
                                            title="{{ cluster.metrics.total_nodes }}">{{ cluster.metrics.total_nodes }}</span></li>
            <li><strong>Nodes Up</strong><span data-fulltext="{{ cluster.metrics.up_nodes }}"
                                               title="{{ cluster.metrics.up_nodes }}">{{ cluster.metrics.up_nodes }}</span></li>
            <li><strong>Nodes Down</strong><span data-fulltext="{{ cluster.metrics.down_nodes }}"
                                                 title="{{ cluster.metrics.down_nodes }}">{{ cluster.metrics.down_nodes }}</span></li>

            <li><strong>Datacenters</strong><span data-fulltext="{{ cluster.metrics.dc_count }}"
                                                  title="{{ cluster.metrics.dc_count }}">{{ cluster.metrics.dc_count }}</span></li>
            <li><strong>Racks</strong><span data-fulltext="{{ cluster.metrics.rack_count }}"
                                            title="{{ cluster.metrics.rack_count }}">{{ cluster.metrics.rack_count }}</span></li>
        </ul>
    </section>

    <section class="fade-in">
        <h2>Keyspaces</h2>
        <input
                type="search"
                id="keyspace-filter"
                placeholder="Filter keyspaces..."
                aria-label="Filter keyspaces"
                autocomplete="off"
        />
        <div class="keyspace-carousel-container">
            <button class="carousel-btn left" aria-label="Scroll keyspaces left">&#8592;</button>

            <div class="keyspace-carousel" id="keyspace-carousel">
                {% for ks in cluster.keyspaces %}
                <article class="keyspace-card">
                    <h3><a href="/cluster/{{ cluster_config_entry }}/keyspace/{{ks.name}}"
                           style="text-decoration: none; color: inherit;">{{ ks.name }}</a></h3>
                    <p><strong>Replication:</strong> {{ ks.replication }}</p>
                    <p><strong>Table Count:</strong> {{ ks.table_count }}</p>
                    <p><strong>Durable Writes:</strong> {{ ks.durable_writes }}</p>
                    <p><strong>Virtual Table:</strong> {{ ks.virtual }}</p>
                </article>
                {% else %}
                <p>No keyspaces data available.</p>
                {% endfor %}
            </div>

            <button class="carousel-btn right" aria-label="Scroll keyspaces right">&#8594;</button>
        </div>
    </section>

    <section class="fade-in">
        <h2>Data Layout</h2>
        <div id="topology-graph" style="width: 100%; height: 400px; border: 1px solid #ccc; border-radius: 8px;"></div>
    </section>
</main>

<footer>
    <p>&copy; {{ current_year }} Oren Kessler - Cassanova</p>
</footer>
</body>
</html>
